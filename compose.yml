name: Talos

include:
  - path: packages/db/docker-compose.yml

services:
  api:
    build:
      context: .
      dockerfile: apps/api/Dockerfile
    container_name: Talos-api
    ports:
      - "3101:3101"
    environment:
      NODE_ENV: production
      DATABASE_URL: postgresql://postgres:password@postgres:5432/Talos
      BETTER_AUTH_SECRET: ${BETTER_AUTH_SECRET}
      BETTER_AUTH_URL: http://localhost:3101
      CORS_ORIGIN: http://localhost:3102
      DEBUG: "false"
    depends_on:
      postgres:
        condition: service_healthy
    restart: unless-stopped

  apimanager:
    build:
      context: .
      dockerfile: apps/apimanager/Dockerfile
      args:
        VITE_API_URL: http://localhost:3101
        VITE_APIMANAGER_URL: http://localhost:3102
    container_name: Talos-apimanager
    ports:
      - "3102:3102"
    environment:
      VITE_API_URL: http://localhost:3101
      VITE_APIMANAGER_URL: http://localhost:3102
    depends_on:
      - api
    restart: unless-stopped

  www:
    build:
      context: .
      dockerfile: apps/www/Dockerfile
      args:
        VITE_SERVER_URL: http://localhost:3101
    container_name: Talos-www
    ports:
      - "3103:3103"
    depends_on:
      - api
    restart: unless-stopped
